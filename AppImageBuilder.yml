# AppImageBuilder configuration for Fooyin v0.9.1
# Based on fooyin_0.9.1-plucky_amd64.deb on Ubuntu 24.04

version: 1
app_id: com.fooyin.Fooyin

AppDir:
  path: AppDir

  app_info:
    id: com.fooyin.Fooyin
    name: Fooyin
    icon: fooyin
    exec: usr/bin/fooyin
    exec_args: $@

  # Dependencies from .deb package and system libraries
  # We'll extract the .deb and then collect all needed files
  apt:
    arch: amd64
    sources:
      - sourceline: deb http://archive.ubuntu.com/ubuntu noble main restricted universe multiverse
      - sourceline: deb http://archive.ubuntu.com/ubuntu noble-updates main restricted universe multiverse
      - sourceline: deb http://security.ubuntu.com/ubuntu noble-security main restricted universe multiverse
    include:
      # Core dependencies from fooyin .deb
      - libqt6core6
      - libqt6gui6
      - libqt6widgets6
      - libqt6dbus6
      - libqt6network6
      - libqt6qml6
      - libqt6quick6
      - libqt6quickcontrols2-6
      - libqt6quicktemplates2-6
      - libqt6sql6-sqlite
      - libqt6multimedia6
      - libqt6opengl6
      - libavcodec59
      - libavformat59
      - libswresample4
      - libswscale6
      - libxcb-xinerama0
      - libxcb-xkb1
      - libxkbcommon-x11-0
      - libxcb-xfixes0
      - libxcb-xinput0
      - libxcb-randr0
      - libxcb-shape0
      - libxcb-xrm0
      - libxcb-present0
      - libgl1
      - libglvnd0
      - libglib2.0-0
      - libgtk-3-0
      - libpng16-16
      - libfreetype6
      - libfontconfig1
      - libharfbuzz0b
      - libpango-1.0-0
      - libpangocairo-1.0-0
      - libx11-xcb1
      - libxcomposite1
      - libxcursor1
      - libxdamage1
      - libxi6
      - libxinerama1
      - libxrandr2
      - libxss1
      - libxtst6
      - zlib1g
      - libc6
      - libstdc++6
      - libgcc-s1

  # Copy files from extracted .deb
  files:
    - source: usr/bin/
      dest: usr/bin/
    - source: usr/lib/
      dest: usr/lib/
    - source: usr/share/applications/
      dest: usr/share/applications/
    - source: usr/share/icons/
      dest: usr/share/icons/
    - source: usr/share/metainfo/
      dest: usr/share/metainfo/
    - source: usr/share/fooyin/
      dest: usr/share/fooyin/
    - source: usr/share/doc/
      dest: usr/share/doc/

  # Ensure icon is present and set correctly
  icons:
    - fooyin.png
    - fooyin.svg

  # Create desktop file if not present or fix it
  desktop:
    enabled: true
    name: Fooyin
    comment: A modern music player with a focus on high-quality audio playback
    exec: usr/bin/fooyin
    icon: fooyin
    terminal: false
    type: Application
    categories:
      - AudioVideo
      - Audio
    mime_types:
      - audio/mpeg
      - audio/x-flac
      - audio/wav
      - audio/x-wav
      - audio/ogg
      - audio/x-ogg
      - audio/aac
      - audio/x-m4a
      - audio/flac
      - audio/mp4

  # Fix permissions
  permissions:
    - usr/bin/fooyin: 755
    - usr/share/applications/com.fooyin.Fooyin.desktop: 644
    - usr/share/icons/hicolor/*/apps/fooyin.*: 644

AppImage:
  update-information: gh-releases-zsync|fooyin|fooyin|v0.9.1|Fooyin-v0.9.1-x86_64.AppImage.zsync
  compress: zstd
  architecture: x86_64
  sign-key: null

  # Optional: Embed runtime (recommended)
  runtime:
    version: latest
