version: 1

AppDir:
  path: ./AppDir
  app_info:
    id: org.fooyin.Fooyin
    name: Fooyin
    icon: fooyin
    version: !ENV ${VERSION}
    exec: usr/local/bin/fooyin
    exec_args: $@

  runtime:
    env:
      LD_LIBRARY_PATH: "${APPDIR}/usr/local/lib:${APPDIR}/usr/local/lib/x86_64-linux-gnu:${APPDIR}/usr/lib/x86_64-linux-gnu:${LD_LIBRARY_PATH}"
      QT_PLUGIN_PATH: "${APPDIR}/usr/local/lib/qt6/plugins:${APPDIR}/usr/local/lib/x86_64-linux-gnu/qt6/plugins"
      QML2_IMPORT_PATH: "${APPDIR}/usr/local/lib/qt6/qml:${APPDIR}/usr/local/lib/x86_64-linux-gnu/qt6/qml"
      QT_QPA_PLATFORM_PLUGIN_PATH: "${APPDIR}/usr/local/lib/qt6/plugins/platforms:${APPDIR}/usr/local/lib/x86_64-linux-gnu/qt6/plugins/platforms"
      PATH: "${APPDIR}/usr/local/bin:${PATH}"

  apt:
    arch: amd64
    sources:
      - sourceline: 'deb http://archive.ubuntu.com/ubuntu jammy main universe'
      - sourceline: 'deb http://archive.ubuntu.com/ubuntu jammy-updates main universe'
    include:
      - libpulse0
      - libasound2
      - libtag1v5
      - libglib2.0-0
      - zlib1g
      - libstdc++6
    exclude:
      - 'libqt6*'
      - 'qt6-*'
      - 'libavcodec*'
      - 'libavformat*'
      - 'libavutil*'
      - 'libswresample*'
      - 'libswscale*'
      - 'libicu70'
      - '*-dev'
      - '*-dbg'
      - '*-doc'

  files:
    include:
      - usr/local/bin/fooyin
      - usr/local/share/applications/fooyin.desktop
      - usr/local/share/icons/hicolor/*/apps/fooyin.png

      # Qt 6.8.0 библиотеки
      - usr/local/lib/libQt6*.so.*
      - usr/local/lib/x86_64-linux-gnu/libQt6*.so.*

      # Qt плагины
      - usr/local/lib/qt6/plugins/**/*
      - usr/local/lib/x86_64-linux-gnu/qt6/plugins/**/*

      # Qt QML
      - usr/local/lib/qt6/qml/**/*
      - usr/local/lib/x86_64-linux-gnu/qt6/qml/**/*

      # FFmpeg 7.x
      - usr/local/lib/libav*.so.*
      - usr/local/lib/libsw*.so.*

      # ICU 76
      - usr/local/lib/libicu*.so.*

    exclude:
      - usr/share/doc
      - usr/share/man
      - usr/local/share/doc
      - usr/local/share/man
      - usr/local/lib/*.so   # исключаем неверсированные symlinks

AppImage:
  arch: x86_64
  update-information: "gh-releases-zsync|fooyin/fooyin|latest|Fooyin-*-x86_64.AppImage.zsync"
