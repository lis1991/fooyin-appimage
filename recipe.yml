version: 1

#script:
  #- rm -r ./AppDir || true

AppDir:
  path: ./AppDir

  app_info:
    id: org.fooyin.Fooyin
    name: Fooyin
    icon: fooyin
    version: !ENV ${VERSION}
    exec: bin/fooyin
    exec_args: $@

  apt:
    arch: amd64
    sources:
      - sourceline: 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu/ jammy main universe'
        key_url: 'http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x871920D1991BC93C'
      - sourceline: 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu/ jammy-updates main universe'
        key_url: 'http://keyserver.ubuntu.com/pks/lookup?op=get&search=0x871920D1991BC93C'
    include:
      - libc6
      - libstdc++6
      - libglib2.0-0
      - libx11-6
      - libxext6
      - libxrender1
      - libxrandr2
      - libxfixes3
      - libxi6
      - libxcb1
      - zlib1g
      - libasound2
      - libpulse0
      - libdbus-1-3
      - libfreetype6
      - libfontconfig1
      - libicu70
      #- libxcb1
      #- libx11-xcb1
      #- libxcb-render0
      #- libxcb-shm0
      #- libxcb-keysyms1
      #- libxcb-image0
      #- libxcb-icccm4
      #- libxcb-sync1
      #- libxcb-xfixes0
      #- libxcb-shape0
      #- libxcb-randr0
      #- libxcb-xinerama0
      - libxcb-cursor0
      - xcb-cursor0

  files:
    include:
      - bin/fooyin
      - share/applications/fooyin.desktop
      - share/icons/hicolor/*/apps/fooyin.png

      # Qt 6.8.0 библиотеки
      - usr/local/lib/libQt6*.so.*
      - usr/local/lib/x86_64-linux-gnu/libQt6*.so.*
      - lib/libQt6*.so.*
      - lib/x86_64-linux-gnu/libQt6*.so.*

      # Qt плагины
      - usr/local/lib/qt6/plugins/**/*
      - usr/local/lib/x86_64-linux-gnu/qt6/plugins/**/*
      - lib/qt6/plugins/**/*
      - lib/x86_64-linux-gnu/qt6/plugins/**/*

      # Qt QML
      - usr/local/lib/qt6/qml/**/*
      - usr/local/lib/x86_64-linux-gnu/qt6/qml/**/*
      - lib/qt6/qml/**/*
      - lib/x86_64-linux-gnu/qt6/qml/**/*

      # FFmpeg 7.x
      - usr/local/lib/libav*.so.*
      - usr/local/lib/libsw*.so.*
      - lib/libav*.so.*
      - lib/libsw*.so.*

      # ICU 76
      - usr/local/lib/libicu*.so.*
      - lib/libicu*.so.*

    exclude:
      - usr/share/doc
      - usr/share/man
      - usr/local/share/doc
      - usr/local/share/man

  test:
    ubuntu:
      image: appimagecrafters/tests-env:ubuntu-jammy
      command: "./AppRun"
      use_host_x: True
    debian:
      image: appimagecrafters/tests-env:debian-stable
      command: "./AppRun"
      use_host_x: True
    centos:
      image: appimagecrafters/tests-env:centos-7
      command: "./AppRun"
      use_host_x: True
    arch:
      image: appimagecrafters/tests-env:archlinux-latest
      command: "./AppRun"
      use_host_x: True
    fedora:
      image: appimagecrafters/tests-env:fedora-30
      command: "./AppRun"
      use_host_x: True

AppImage:
  arch: x86_64
  update-information: "gh-releases-zsync|fooyin/fooyin|latest|Fooyin-*-x86_64.AppImage.zsync"
